-- Load WindUI
local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

-- Window
local Window = WindUI:CreateWindow({
    Title = "PVP Script (test)",
    Icon = "user",
    Author = "https://discord.gg/AXTKtmUvyf",
    OpenButton = {
        Title = "Felon HUB",
        Icon = "sword",
        Enabled = true,
        Draggable = true,
    }
})

local Main = Window:Tab({
    Title = "Main",
    Icon = "star",
})

Main:Section({ Title = " Player Settings " })
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local connection -- ตัวแปรสำหรับเก็บการเชื่อมต่อ loop

-- ฟังก์ชันหาผู้เล่นที่ใกล้ที่สุด
local function getClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = math.huge

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (LocalPlayer.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                closestPlayer = player
            end
        end
    end
    return closestPlayer
end

Main:Toggle({
    Title = "Orbit Nearest Player",
    Desc = "วาร์ปไปลอยวนบนหัวคนที่ใกล้ที่สุด",
    Value = false,
    Callback = function(v)
        if v then
            -- เริ่มทำงานเมื่อเปิด Switch
            connection = RunService.Heartbeat:Connect(function()
                local target = getClosestPlayer()
                if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
                    local rootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                    local targetPart = target.Character.HumanoidRootPart
                    
                    -- คำนวณตำแหน่งการหมุน (ลอยสูงขึ้น 5 หน่วย และหมุนรอบตัว)
                    local speed = tick() * 5 -- ความเร็วในการหมุน
                    local radius = 3 -- ระยะห่างจากตัวเป้าหมาย
                    local offset = Vector3.new(math.sin(speed) * radius, 5, math.cos(speed) * radius)
                    
                    if rootPart then
                        rootPart.CFrame = CFrame.new(targetPart.Position + offset, targetPart.Position)
                    end
                end
            end)
        else
            -- หยุดทำงานเมื่อปิด Switch
            if connection then
                connection:Disconnect()
                connection = nil
            end
        end
    end
})
