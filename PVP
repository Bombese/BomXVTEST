-- Load WindUI
local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

-- Window
local Window = WindUI:CreateWindow({
    Title = "PVP Script (Premium)",
    Icon = "user",
    Author = "https://discord.gg/AXTKtmUvyf",
    OpenButton = {
        Title = "Felon HUB",
        Icon = "sword",
        Enabled = true,
        Draggable = true,
    }
})

local Main = Window:Tab({
    Title = "Main",
    Icon = "star",
})

Main:Section({ Title = " Player Settings " })

-- สร้างตัวแปรเก็บชื่อผู้เล่นที่เลือก
local SelectedPlayer = nil

-- 1. สร้าง Dropdown สำหรับเลือกผู้เล่น
local PlayerDropdown = Tabs.Main:AddDropdown({
    Title = "เลือกผู้เล่น",
    Multi = false,
    Options = {}, -- เริ่มต้นเป็นว่างไว้
    Default = nil,
    Callback = function(Value)
        SelectedPlayer = Value
        print("เลือกผู้เล่น: " .. Value)
    end
})

-- ฟังก์ชันสำหรับอัปเดตรายชื่อผู้เล่นใน Dropdown
local function UpdatePlayerList()
    local players = {}
    for _, v in pairs(game:GetService("Players"):GetPlayers()) do
        table.insert(players, v.Name)
    end
    PlayerDropdown:SetValues(players)
end

-- อัปเดตรายชื่อทันทีที่รันสคริปต์ และอัปเดตเมื่อมีคนเข้า/ออก
UpdatePlayerList()
game:GetService("Players").PlayerAdded:Connect(UpdatePlayerList)
game:GetService("Players").PlayerRemoving:Connect(UpdatePlayerList)

--- 2. Toggle สำหรับเปิด/ปิดการลอยวน (Orbit)
Tabs.Main:AddToggle({
    Title = "เปิดระบบ Orbit",
    Value = false,
    Callback = function(Value)
        _G.OrbitEnabled = Value
        
        if _G.OrbitEnabled and SelectedPlayer then
            local RunService = game:GetService("RunService")
            
            _G.OrbitConnection = RunService.RenderStepped:Connect(function()
                if not _G.OrbitEnabled then 
                    _G.OrbitConnection:Disconnect() 
                    return 
                end
                
                local targetPlayer = game:GetService("Players"):FindFirstChild(SelectedPlayer)
                if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    local char = targetPlayer.Character
                    local hrp = char.HumanoidRootPart
                    
                    local orb = char:FindFirstChild("OrbitPart")
                    if not orb then
                        orb = Instance.new("Part")
                        orb.Name = "OrbitPart"
                        orb.Size = Vector3.new(1, 1, 1)
                        orb.Shape = Enum.PartType.Ball
                        orb.Color = Color3.fromRGB(0, 255, 255) -- สีฟ้า Cyan
                        orb.Material = Enum.Material.Neon
                        orb.CanCollide = false
                        orb.Anchored = true
                        orb.Parent = char
                    end
                    
                    -- สูตรคำนวณวงกลม
                    local time = tick() * 5
                    local offsetX = math.cos(time) * 4
                    local offsetZ = math.sin(time) * 4
                    orb.CFrame = hrp.CFrame * CFrame.new(offsetX, 3, offsetZ)
                end
            end)
        else
            -- ลบพาร์ทออกเมื่อปิด
            for _, p in pairs(game:GetService("Players"):GetPlayers()) do
                if p.Character and p.Character:FindFirstChild("OrbitPart") then
                    p.Character.OrbitPart:Destroy()
                end
            end
        end
    end
})
