-- Load WindUI
local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

-- Window
local Window = WindUI:CreateWindow({
    Title = "PVP Script (test)",
    Icon = "user",
    Author = "https://discord.gg/AXTKtmUvyf",
    OpenButton = {
        Title = "Felon HUB",
        Icon = "sword",
        Enabled = true,
        Draggable = true,
    }
})

local Main = Window:Tab({
    Title = "Main",
    Icon = "star",
})

Main:Section({ Title = " Player Settings " })

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local lp = Players.LocalPlayer
local orbitConnection = nil

-- ฟังก์ชันหาคนใกล้ที่สุด
local function getClosest()
    local target = nil
    local dist = math.huge
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= lp and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
            local magnitude = (lp.Character.HumanoidRootPart.Position - v.Character.HumanoidRootPart.Position).Magnitude
            if magnitude < dist then
                dist = magnitude
                target = v
            end
        end
    end
    return target
end

-- สำหรับ Wind UI โครงสร้างจะเป็นแบบนี้:
Main:AddToggle({
    Title = "Orbit Nearest Player",
    Desc = "วาร์ปไปลอยวนบนหัวคนที่ใกล้ที่สุด",
    Value = false, -- ค่าเริ่มต้น
    Callback = function(v)
        if v then
            -- ถ้ามีงานเก่าค้างอยู่ให้ปิดก่อนเพื่อกันซ้อน
            if orbitConnection then orbitConnection:Disconnect() end
            
            orbitConnection = RunService.Heartbeat:Connect(function()
                -- ใช้ pcall ครอบไว้กันสคริปต์หลุดเวลาคนที่เราตามกดรีเซ็ตตัวละคร
                pcall(function()
                    local target = getClosest()
                    if target and target.Character and lp.Character then
                        local root = lp.Character:FindFirstChild("HumanoidRootPart")
                        local targetRoot = target.Character:FindFirstChild("HumanoidRootPart")
                        
                        if root and targetRoot then
                            local t = tick() * 4 -- ความเร็วในการหมุน (ปรับเลข 4 ได้)
                            local radius = 6 -- ระยะห่างวงกลม
                            local height = 5 -- ความสูงเหนือหัว
                            
                            -- คำนวณตำแหน่งใหม่
                            local orbitPos = targetRoot.Position + Vector3.new(math.sin(t) * radius, height, math.cos(t) * radius)
                            
                            -- วาร์ปและหันหน้าไปหาเป้าหมาย
                            root.CFrame = CFrame.new(orbitPos, targetRoot.Position)
                        end
                    end
                end)
            end)
        else
            -- เมื่อกดปิด
            if orbitConnection then
                orbitConnection:Disconnect()
                orbitConnection = nil
            end
        end
    end
})
